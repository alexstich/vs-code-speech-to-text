# PRD: VS Code Speech-to-Text Extension

## 1. Обзор проекта

### 1.1 Название проекта
VS Code Speech-to-Text Extension (рабочее название: "VoiceScribe")

### 1.2 Краткое описание
Расширение для Visual Studio Code и Cursor IDE, которое позволяет транскрибировать речь в текст с помощью OpenAI Whisper API. Расширение обеспечивает простой способ голосового ввода текста непосредственно в редактор кода или в чат AI.

### 1.3 Цель проекта
Повысить производительность разработчиков, позволяя им быстро вводить текст, комментарии, документацию и вопросы в AI-чат с помощью голоса вместо печати.

## 2. Проблема и решение

### 2.1 Проблема
- Медленный ввод длинных текстов и комментариев при программировании
- Необходимость переключения между клавиатурой и микрофоном при работе с AI-чатом
- Отсутствие нативной поддержки голосового ввода в популярных IDE
- Утомляемость при длительном наборе текста

### 2.2 Решение
Расширение VS Code, которое:
- Интегрируется с OpenAI Whisper API для высококачественной транскрибации
- Поддерживает два режима записи: "нажал-держи-отпустил" и "нажал-говори-нажал"
- Работает как в редакторе кода, так и в AI-чате Cursor IDE
- Обеспечивает локальную запись аудио с последующей отправкой в API

## 3. Технический анализ

### 3.1 VS Code Extension API
**Возможности:**
- `vscode.commands.registerCommand` - регистрация команд
- `vscode.window.createStatusBarItem` - добавление элементов в статус-бар
- `vscode.workspace.onDidChangeTextDocument` - отслеживание изменений в документах
- `vscode.window.activeTextEditor` - работа с активным редактором
- `vscode.env.clipboard` - работа с буфером обмена
- Webview API для создания пользовательского интерфейса
- Поддержка горячих клавиш через `package.json`

**Архитектура расширения:**
- Extension Host - изолированная среда выполнения расширений
- Main Process - основной процесс VS Code
- Renderer Process - процесс отображения интерфейса

### 3.2 OpenAI Whisper API
**Технические характеристики:**
- **Лимит размера файла:** 25 МБ
- **Поддерживаемые форматы:** m4a, mp3, webm, mp4, mpga, wav, mpeg
- **Лимит длительности:** нет явного ограничения (ограничен размером файла)
- **Стоимость:** $0.006 за минуту аудио
- **Языки:** поддержка 95+ языков
- **Точность:** ~92% в среднем (WER 8.06%)

**Ограничения:**
- Нет поддержки стриминга (только полные файлы)
- API rate limits (не детализированы публично)
- Потенциальные галлюцинации в транскрипции (~1.4% случаев)

### 3.3 Интеграция с Cursor IDE
**Текущее состояние:**
- Cursor основан на VS Code, поэтому большинство VS Code расширений совместимы
- Нет официального API для прямой интеграции с AI-чатом
- Возможности интеграции через:
  - Model Context Protocol (MCP) - для расширенной интеграции
  - Стандартные команды VS Code
  - Webview для создания собственного UI
  - Буфер обмена для передачи текста

**Обходные решения:**
- Использование `vscode.env.clipboard.writeText()` для копирования текста в буфер
- Автоматическая вставка в активный текстовый элемент
- Интеграция через команды клавиатуры (Ctrl+V)

## 4. Функциональные требования

### 4.1 Основная функциональность

#### 4.1.1 Аудио запись
- **Режим 1 (Hold-to-Record):** Нажал и держи кнопку → говори → отпустил → транскрибация
- **Режим 2 (Toggle Record):** Нажал кнопку (старт) → говори → нажал кнопку (стоп) → транскрибация
- Визуальная индикация состояния записи
- Поддержка горячих клавиш (настраиваемые)
- Максимальная длительность записи: 5 минут (ограничение размера файла)

#### 4.1.2 Обработка аудио
- Запись в формате WAV (16 кГц, моно) для оптимизации размера
- Автоматическое сжатие при превышении лимитов API
- Фильтрация тишины в начале/конце записи
- Проверка качества аудио перед отправкой

#### 4.1.3 Транскрибация
- Интеграция с OpenAI Whisper API
- Поддержка автоопределения языка
- Возможность указания конкретного языка
- Обработка ошибок API и повторные попытки
- Показ прогресса обработки

#### 4.1.4 Вставка текста
- Вставка в позицию курсора в активном редакторе
- Вставка в AI-чат (через буфер обмена или прямую интеграцию)
- Предварительный просмотр транскрибированного текста
- Возможность редактирования перед вставкой

### 4.2 Пользовательский интерфейс

#### 4.2.1 Статус-бар
- Иконка микрофона с индикацией состояния
- Показ времени записи
- Быстрый доступ к настройкам

#### 4.2.2 Команды палитры
- "VoiceScribe: Start Recording"
- "VoiceScribe: Stop Recording"  
- "VoiceScribe: Toggle Recording Mode"
- "VoiceScribe: Open Settings"
- "VoiceScribe: Show History"

#### 4.2.3 Настройки
- API ключ OpenAI
- Выбор языка транскрибации
- Настройка горячих клавиш
- Выбор режима записи по умолчанию
- Настройки качества аудио

### 4.3 Интеграция с Cursor IDE

#### 4.3.1 Обнаружение контекста
- Автоматическое определение активного контекста (редактор/чат)
- Адаптация поведения в зависимости от контекста

#### 4.3.2 AI-чат интеграция
- Вставка транскрибированного текста в поле ввода чата
- Возможность автоматической отправки сообщения
- Сохранение истории голосовых команд

## 5. Нефункциональные требования

### 5.1 Производительность
- Время запуска записи: < 200мс
- Время транскрибации: зависит от API (обычно 2-5 секунд для минуты аудио)
- Размер расширения: < 10 МБ
- Потребление памяти: < 50 МБ во время записи

### 5.2 Безопасность
- Локальная обработка аудио (не сохранение на серверах расширения)
- Шифрование API ключей в конфигурации
- Опциональное удаление аудио файлов после транскрибации
- Предупреждения о конфиденциальности

### 5.3 Совместимость
- VS Code версии 1.74.0 и выше
- Cursor IDE (актуальная версия)
- Поддержка Windows, macOS, Linux
- Node.js совместимость

### 5.4 Надежность
- Graceful handling отказов API
- Автоматические повторные попытки при временных сбоях
- Валидация аудио файлов перед отправкой
- Резервные механизмы при превышении лимитов

## 6. Пользовательские сценарии

### 6.1 Сценарий 1: Быстрый комментарий в коде
1. Разработчик позиционирует курсор перед функцией
2. Нажимает и держит горячую клавишу (F9)
3. Говорит: "Эта функция вычисляет факториал числа используя рекурсию"
4. Отпускает клавишу
5. Через 3 секунды в коде появляется комментарий: `// Эта функция вычисляет факториал числа используя рекурсию`

### 6.2 Сценарий 2: Вопрос в AI-чат
1. Разработчик открывает AI-чат в Cursor
2. Нажимает иконку микрофона в статус-баре
3. Говорит: "Как лучше оптимизировать этот SQL запрос для большой таблицы?"
4. Нажимает иконку микрофона для остановки
5. Текст автоматически вставляется в поле чата и отправляется

### 6.3 Сценарий 3: Документация функции
1. Разработчик выделяет функцию
2. Использует команду "VoiceScribe: Document Function"
3. Говорит описание параметров и возвращаемого значения
4. Расширение генерирует JSDoc комментарий на основе транскрипции

## 7. Техническая архитектура

### 7.1 Компоненты системы

```
┌─────────────────────────────────────┐
│             VS Code UI              │
├─────────────────────────────────────┤
│  StatusBar │ Commands │ Settings    │
├─────────────────────────────────────┤
│        Extension Host               │
│  ┌─────────────────────────────────┐│
│  │     VoiceScribe Extension       ││
│  │                                 ││
│  │  ┌─────────────────────────────┐││
│  │  │    Audio Recorder           │││
│  │  └─────────────────────────────┘││
│  │  ┌─────────────────────────────┐││
│  │  │    API Client               │││
│  │  └─────────────────────────────┘││
│  │  ┌─────────────────────────────┐││
│  │  │    Text Inserter            │││
│  │  └─────────────────────────────┘││
│  │  ┌─────────────────────────────┐││
│  │  │    Context Manager          │││
│  │  └─────────────────────────────┘││
│  └─────────────────────────────────┘│
└─────────────────────────────────────┘
            │
            ▼
    ┌──────────────────┐
    │  OpenAI Whisper  │
    │      API         │
    └──────────────────┘
```

### 7.2 Основные модули

#### 7.2.1 AudioRecorder
```typescript
interface AudioRecorder {
    startRecording(): Promise<void>;
    stopRecording(): Promise<AudioBuffer>;
    isRecording(): boolean;
    getRecordingDuration(): number;
}
```

#### 7.2.2 WhisperClient
```typescript
interface WhisperClient {
    transcribe(audio: AudioBuffer, options: TranscriptionOptions): Promise<string>;
    checkApiKey(): Promise<boolean>;
    getUsageStats(): Promise<UsageStats>;
}
```

#### 7.2.3 TextInserter
```typescript
interface TextInserter {
    insertAtCursor(text: string): Promise<void>;
    insertInChat(text: string): Promise<void>;
    detectContext(): 'editor' | 'chat' | 'unknown';
}
```

### 7.3 Структура проекта

```
voice-scribe-extension/
├── package.json                 # Манифест расширения
├── src/
│   ├── extension.ts            # Главный файл расширения
│   ├── audioRecorder.ts        # Модуль записи аудио
│   ├── whisperClient.ts        # Клиент OpenAI API
│   ├── textInserter.ts         # Модуль вставки текста
│   ├── contextManager.ts       # Управление контекстом
│   ├── statusBar.ts            # Интеграция со статус-баром
│   ├── settings.ts             # Управление настройками
│   └── utils/
│       ├── audioUtils.ts       # Утилиты для работы с аудио
│       └── errorHandler.ts     # Обработка ошибок
├── media/                      # Иконки и ресурсы
├── webview/                    # UI компоненты (если нужны)
└── test/                       # Тесты
```

## 8. План разработки

### 8.1 Этап 1: MVP (2-3 недели)
- [x] Создание базовой структуры расширения
- [ ] Реализация аудио записи (режим hold-to-record)
- [ ] Интеграция с OpenAI Whisper API
- [ ] Базовая вставка текста в редактор
- [ ] Простой UI в статус-баре

### 8.2 Этап 2: Расширенная функциональность (1-2 недели)
- [ ] Режим toggle-recording
- [ ] Интеграция с Cursor AI-чатом
- [ ] Настройки и конфигурация
- [ ] Обработка ошибок и повторные попытки
- [ ] Предварительный просмотр транскрипции

### 8.3 Этап 3: Оптимизация и полировка (1 неделя)
- [ ] Оптимизация производительности
- [ ] Улучшение UX
- [ ] Тестирование на разных платформах
- [ ] Документация пользователя

### 8.4 Этап 4: Дополнительные функции (опционально)
- [ ] История транскрипций
- [ ] Настраиваемые команды
- [ ] Поддержка множественных языков
- [ ] Offline режим (с локальными моделями)

## 9. Риски и митигация

### 9.1 Технические риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Лимиты OpenAI API | Средняя | Высокое | Реализация локального кэширования, предупреждения |
| Проблемы с аудио на разных ОС | Высокая | Среднее | Тестирование на всех платформах, fallback решения |
| Изменения VS Code API | Низкая | Высокое | Использование стабильных API, мониторинг изменений |
| Качество транскрибации | Средняя | Среднее | Предварительный просмотр, возможность редактирования |

### 9.2 Бизнес риски

| Риск | Вероятность | Влияние | Митигация |
|------|-------------|---------|-----------|
| Стоимость API | Средняя | Среднее | Мониторинг использования, предупреждения о лимитах |
| Конкуренция | Высокая | Низкое | Фокус на уникальные функции, быстрая итерация |
| Проблемы конфиденциальности | Низкая | Высокое | Четкая политика приватности, локальная обработка |

## 10. Метрики успеха

### 10.1 Технические метрики
- Время отклика: < 5 секунд для транскрибации 1 минуты аудио
- Точность транскрибации: > 90% для четкой речи
- Частота ошибок: < 1% крашей на сессию использования
- Время установки: < 30 секунд

### 10.2 Пользовательские метрики
- Количество установок: 1000+ в первый месяц
- Активные пользователи: 70% retention через неделю
- Средняя частота использования: 10+ транскрипций в день на активного пользователя
- Рейтинг в Marketplace: 4.0+ звезд

## 11. Заключение

Данное расширение решает реальную проблему разработчиков - необходимость быстрого голосового ввода в IDE. С использованием OpenAI Whisper API и интеграции с VS Code/Cursor IDE, проект имеет все шансы стать полезным инструментом для повышения продуктивности разработчиков.

Ключевые преимущества:
- Простота использования (2 клика для начала записи)
- Высокое качество транскрибации благодаря Whisper
- Нативная интеграция с популярными IDE
- Гибкие настройки под разные сценарии использования

Следующий шаг - начать разработку MVP с базовой функциональностью записи и транскрибации.
